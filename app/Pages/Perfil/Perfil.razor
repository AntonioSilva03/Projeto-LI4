@page "/Perfil"

@inject NavigationManager NavigationManager

@code {
    private string nickname = "";
    private string email = "";
    private string telemovel = "";
    private string id = "";

    private string alterar_nickname = "";
    private string alterar_email = "";
    private string alterar_telemovel = "";

    public bool alterar_dados = false;

    protected override void OnInitialized()
    {
        put_values();
        base.OnInitialized();
    }

    void put_values(){
        Pessoa utilizador = CurrentUser.user;

        if (utilizador != null) {
            nickname = utilizador.getNickname();
            email = utilizador.getEmail();
            telemovel = (utilizador.getTelemovel()).ToString();
            id = (utilizador.getID()).ToString();
        }
    }

    void eliminar(){
        Pessoa utilizador = CurrentUser.user;
        IDatabaseFacade db = new DatabaseFacade();

        db.remove_Pessoa(utilizador.getID());

        CurrentUser.logout();

        NavigationManager.NavigateTo("/", forceLoad:true);
    }

    void alterar_dados_conta(){
        alterar_dados = true;
    }

    void guardar_alteracoes(){
        alterar_dados = false;
        IDatabaseFacade db = new DatabaseFacade();
        Pessoa utilizador = CurrentUser.user;

        if(alterar_nickname != "")
        {
            nickname = alterar_nickname;
            utilizador.setNickname(nickname);
        }
        if(alterar_email != "")
        {
            email = alterar_email;
            utilizador.setEmail(email);
        }
        if(alterar_telemovel != "")
        {
            telemovel = alterar_telemovel;
            utilizador.setTelemovel(int.Parse(telemovel));
        }
        db.add_Pessoa(utilizador);
        NavigationManager.NavigateTo("/Perfil", forceLoad:true);
    }
}

<PageTitle>Perfil</PageTitle>

<div class="title-container">
    <h1 class="profile-page-title">Perfil</h1>
    @if(!CurrentUser.isAdmin && !alterar_dados) {
        <div class="delete-profile" @onclick="@eliminar">
            <a>
                <p>Eliminar perfil</p>
            </a>
        </div>
    }
</div>

<div class="profile-container">
    <div class="profile-info-box">
        @if(!alterar_dados) {
            <p class="profile-info">Nickname: @nickname</p>
            <p class="profile-info">E-mail: @email</p>
            <p class="profile-info">Telemóvel: @telemovel</p>
        }

        @if(alterar_dados) {
            <p class="profile-info">
                <label for="nickname">Nickname: </label>
                <input class="edit-info" type="text" placeholder=" @nickname" @bind="@alterar_nickname" />
            </p>

            <p class="profile-info">
                <label for="email">E-mail: </label>
                <input class="edit-input" type="text" placeholder=" @email" @bind="@alterar_email" />
            </p>

            <p class="profile-info">
                <label for="telemovel">Telemóvel: </label>
                <input class="edit-input" type="text" placeholder=" @telemovel" @bind="@alterar_telemovel" />
            </p>
        }

        <p class="profile-info">ID: @id</p>

        @if(!alterar_dados) {
            <div class="edit-profile" @onclick="@alterar_dados_conta">
                <a>Alterar dados da conta</a>
            </div>
        }

        @if(alterar_dados) {
            <div class="edit-profile" @onclick="@guardar_alteracoes">
                <a>Guardar alterações</a>
            </div>
        }
    </div>

    @if(!CurrentUser.isAdmin) {
        <div class="transactions-history-button">
            <a>Histórico de <br> transações</a>
        </div>
    }
</div>